(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.wp.plugins,n=window.wp.data,s=window.wp.domReady;var o=e.n(s);const r=window.React,c=window.wp.i18n,i=window.wp.editPost,a=window.wp.components,l=()=>(0,r.createElement)(a.Icon,{icon:(0,r.createElement)("svg",{version:"1.1",id:"consistency-plugin",x:"0px",y:"0px",width:"24px",height:"24px",viewBox:"0 0 24 24",enableBackground:"new 0 0 24 24"},(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"4",y1:"20",x2:"7",y2:"20"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"14",y1:"20",x2:"21",y2:"20"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"6.9",y1:"15",x2:"13.8",y2:"15"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"10.2",y1:"6.3",x2:"16",y2:"20"}),(0,r.createElement)("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:"5,20 11,4 13,4 20,20 "}))}),u=window.wp.coreData,d=window.wp.notices,p=e=>{const{settingSlug:t,settingName:s,settingDescription:o}=e,{currentUser:i}=(0,n.useSelect)((e=>({currentUser:e(u.store).getCurrentUser()})),[]),l=i&&i.id,[p,g]=(0,u.useEntityProp)("root","user","meta",l),{saveEditedEntityRecord:_}=(0,n.useDispatch)(u.store),{createNotice:m}=(0,n.useDispatch)(d.store);return(0,r.createElement)(a.ToggleControl,{label:s,help:(0,r.createElement)("span",{dangerouslySetInnerHTML:o}),checked:p?.consistency_plugin_user_settings?.find((e=>e.slug===t))?.value||!1,onChange:e=>{let n=p?.consistency_plugin_user_settings.map((n=>t===n.slug?{...n,value:e}:n));n?.find((e=>e.slug===t))||n.push({slug:t,value:e}),g({...p,consistency_plugin_user_settings:n}),_("root","user",l,{...p,meta:n}),m((0,c.__)("info","consistency"),e?sprintf((0,c.__)('"%1$s" Correction is enabled',"consistency"),s):sprintf((0,c.__)('"%1$s" Correction is disabled',"consistency"),s),{isDismissible:!0,type:"snackbar",speak:!0})}})},{getEntityRecord:g}=(0,n.select)("core"),_=[{name:"quote",mask:/\'/,replace:"’",nbMoved:0,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"ellipsis",mask:/\.{3}/,replace:"…",nbMoved:-2,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB","de_DE","de_AT","de_CH","ro_RO"]},{name:"2hyphens",mask:/(?:\-)\-/,replace:"—",nbMoved:-1,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB","de_DE","de_AT","de_CH","ro_RO"]},{name:"ordinalNumberSuffix",mask:/([10-9]{1,20})(th|nd|rd|e|er|res|d|ds|de|des)(?= | )/,replace:"$1<sup>$2</sup>",nbMoved:0,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"regularToCurlyQuotes",mask:/"/,replace:"“$1”",nbMoved:0,locales:["en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"regularToGermanQuotes",mask:/"/,replace:"„$1“",nbMoved:0,locales:["de_DE","de_AT","ro_RO"]},{name:"regularToGermanBookStyleQuotes",mask:/"/,replace:"»$1«",nbMoved:0,locales:["de_DE","de_AT"]},{name:"regularToFrenchQuotes",mask:/"/,replace:"« $1 »",nbMoved:1,locales:["fr_FR","fr_BE"]},{name:"regularToFrenchQuotesWithoutSpaces",mask:/"/,replace:"«$1»",nbMoved:0,locales:["de_CH"]},{name:"breakingSpace",mask:/ ([\?|\!|\:|\;|»|€|\$|£|¥|₽|元|\%])/,replace:" $1",nbMoved:0,locales:["fr_FR","fr_BE"]},{name:"noSpaceBefore",mask:/(?<! | |&nbsp;)([\?|\!|\:|»|€|\$|£|¥|₽|元|\%])/,replace:" $1",nbMoved:1,locales:["fr_FR","fr_BE"]},{name:"noNonBreakingSpaceAfter",mask:/(«)(?! | |&nbsp;)/,replace:"$1 ",nbMoved:0,locales:["fr_FR","fr_BE"]},{name:"noBreakingSpaceAfter",mask:/([\,|…|\)|\]])(?! | |\.|\,|\d)/,replace:"$1 ",nbMoved:1,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"capitalizeFirstSentenceLetter",mask:/(^[a-záàâäãåăçéèêëíìîïñóòôöõúùûüýÿæœșț])|(?<=[\.|\?|\!|…] )[a-záàâäãåăçéèêëíìîïñóòôöõúùûüýÿæœșț]/,replace:e=>e.toUpperCase(),nbMoved:0,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB","de_DE","de_AT","de_CH","ro_RO"]},{name:"spaceBefore",mask:/([ | ])(?=[\?|\!|\:|\;|\%])/,replace:"",nbMoved:-1,locales:["en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB","de_DE","de_AT","de_CH","ro_RO"]}],m=["regularToCurlyQuotes","regularToFrenchQuotes","regularToFrenchQuotesWithoutSpaces","regularToGermanQuotes","regularToGermanBookStyleQuotes"],y=["core/paragraph","core/heading","core/quote","core/list-item","core/read-more"],{getBlockName:h,getBlockAttributes:f}=(0,n.select)("core/block-editor"),b=e=>{const t=(()=>{const e=g("root","site");return e?.language||"en_US"})(),n=_?.find((t=>t.name===e));return!(void 0===n||!n?.locales?.includes(t))},k=e=>{const{settingSlug:t,settingName:s,settingDescription:o}=e;if(!b(t))return"";const[i,l]=(0,u.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:p}=(0,n.useDispatch)(u.store),{createNotice:g}=(0,n.useDispatch)(d.store);return(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(a.ToggleControl,{label:s,help:(0,r.createElement)("span",{dangerouslySetInnerHTML:o}),checked:i?.find((e=>e.slug===t))?.value||!1,onChange:e=>{let n=i.map((n=>t===n.slug?{...n,value:e}:n));n?.find((e=>e.slug===t))||n.push({slug:t,value:e}),l(n),p("root","site",void 0,n),g((0,c.__)("info","consistency"),e?sprintf((0,c.__)('"%1$s" Correction is enabled',"consistency"),s):sprintf((0,c.__)('"%1$s" Correction is disabled',"consistency"),s),{isDismissible:!0,type:"snackbar",speak:!0})}}))},{canUser:E}=(0,n.select)("core"),{getBlock:S,getBlocks:v,getBlockAttributes:w,getSelectionStart:C,isTyping:A}=(0,n.select)("core/block-editor"),{updateBlock:B,selectionChange:R,updateBlockAttributes:x}=(0,n.dispatch)("core/block-editor"),N=t=>{const{currentBlockId:n,isPasting:s,settings:o}=t;let r=_.filter((e=>!0===o?.find((t=>t.slug===e.name))?.value));const c=S(n);if(!(e=>{const t=h(e);return!!y.includes(t)})(n)||!(e=>{const t=f(e);return!(!t||!t.hasOwnProperty("content")||""===t.content)})(n))return;let i=w(n);Object.entries(r).forEach((([t,o])=>{e.g.consistencyLoop++,(t=>{e.g.consistencyLoop>=150&&(t=>{const n=getBlock(t);updateBlock(t,{...n,attributes:{...n.attributes,content:n.attributes.content.slice(-2)}}),e.g.consistency_loop=0,console.log("Consistency - a memory leak has occured during the fix of the following block:",n)})(t)})(n);let r,a=o.replace,l="",u="",d=0,p=i.content,g=(e=>e.replace(/<\b(code|pre|kbd)\b>.*?<\/\b(code|pre|kbd)\b>/gi,"").replace(/(<([^>]+)>)/gi,""))(p),_=!1;if(A()||(_=o.mask.test(g)),A()){r=C(c.name),d=r?.offset||0;const e=(e=>{const t=document.querySelector(`#block-${e}`);if(null===t)return;const n=document.getSelection(),s=n?.getRangeAt(0);if(!s.collapsed)return;const o=s.cloneRange(),r=document.createTextNode("\0");o.insertNode(r);let c=t?.innerHTML?.indexOf("\0");r.parentNode.removeChild(r),t.normalize();const i=(t?.innerHTML.match(/&nbsp;/g)||[]).length;return i>0&&(c=c-6*i+i),c})(n)||d,t=g.match(o.mask);if(null===t||0===t.length)return;const s=t[0].length||1;l=p.substring(0,e-s),u=p.substring(e-s,p.length),_=o.mask.test(g)&&o.mask.test(u)}_&&b(o.name)&&((e=>!!m.includes(e.name))(o)&&(a=((e,t,n)=>{const s=e.replace.charAt(0),o=e.replace.charAt(e.replace.length-1),r=e.replace.substring(1,e.replace.indexOf("$"))||"";let c="";0!==[...e.replace.matchAll(/[0-9]/g)].length&&(c=e.replace.substring([...e.replace.matchAll(/[0-9]/g)].pop().index+1,e.replace.length-1));const i=new RegExp(`${s}`,"g"),a=new RegExp(`${o}`,"g");return(t.match(i)||[]).length===(t.match(a)||[]).length?s+r:c+o})(o,p)),0!==d&&(p=l+u.replace(o.mask,a)),0===d&&(p=p.replace(o.mask,o.replace)),e.g.previousFixCanceled?e.g.previousFixCanceled=!1:(e.g.previousFixCanceled||B(n,{...c,attributes:{...c.attributes,content:p}}),0===o.nbMoved||0===d||s||(o.nbMoved<0&&R(n,r.attributeKey,d-1,d+o.nbMoved),o.nbMoved>0&&R(n,r.attributeKey,d+1+o.nbMoved,d+o.nbMoved))))})),e.g.consistencyLoop=0},{getSelectedBlockClientId:T,isTyping:D,getBlockAttributes:F}=(0,n.select)("core/block-editor");(0,t.registerPlugin)("consistency-custom-sidebar",{render:()=>{const e=E("create","users");return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(i.PluginSidebar,{name:"consistency-custom-sidebar",title:(0,c.__)("Consistency","consistency"),icon:l},(0,r.createElement)(a.PanelBody,{title:(0,c.__)("Settings for my account","consistency"),initialOpen:!0},(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(p,{settingSlug:"on_the_fly",settingName:(0,c.__)("On-the-fly autocorrect","consistency"),settingDescription:{__html:(0,c.__)("Enable/disable on-the-fly autocorrect for my account","consistency")}})),(0,r.createElement)(a.PanelRow,null,(0,r.createElement)(p,{settingSlug:"on_paste",settingName:(0,c.__)("On paste autocorrect","consistency"),settingDescription:{__html:(0,c.__)("Enable/disable autocorrect on paste for my account","consistency")}}))),e&&(0,r.createElement)(a.PanelBody,{title:(0,c.__)("Global correction rules","consistency"),initialOpen:!1},(0,r.createElement)(k,{settingSlug:"quote",settingName:(0,c.__)("Straight quote","consistency"),settingDescription:{__html:(0,c.__)("Replaces straight quotes with curved quotes:","consistency")+"<span aria-hidden='true' style='display:block;'><code>'</code> <span style='font-size:20px'>→</span> <code>’</code></span>"}}),(0,r.createElement)(k,{settingSlug:"ellipsis",settingName:(0,c.__)("Ellipsis","consistency"),settingDescription:{__html:(0,c.__)("Replaces 3 dots with ellipsis:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>...</code> <span style={ { fontSize: '20px' } }>→</span> <code>…</code></span>"}}),(0,r.createElement)(k,{settingSlug:"2hyphens",settingName:(0,c.__)("Two hyphens","consistency"),settingDescription:{__html:(0,c.__)("Replaces 2 hyphens with em dash:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>--</code> <span style={ { fontSize: '20px' } }>→</span> <code>—</code></span>"}}),(0,r.createElement)(k,{settingSlug:"ordinalNumberSuffix",settingName:(0,c.__)("Ordinal number suffix","consistency"),settingDescription:{__html:(0,c.__)("Add HTML tag sup to ordinal number suffix","consistency")}}),(0,r.createElement)(k,{settingSlug:"regularToCurlyQuotes",settingName:(0,c.__)("Regular quotes to curly","consistency"),settingDescription:{__html:(0,c.__)("Replaces regular quotes with curly quotes:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>\" \"</code> <span style={ { fontSize: '20px' } }>→</span> <code>“ ”</code></span>"}}),(0,r.createElement)(k,{settingSlug:"regularToGermanQuotes",settingName:(0,c.__)("Regular quotes to german","consistency"),settingDescription:{__html:(0,c.__)("Replaces regular quotes with german quotes:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>\" \"</code> <span style={ { fontSize: '20px' } }>→</span> <code>„ “</code></span>"}}),(0,r.createElement)(k,{settingSlug:"regularToGermanBookStyleQuotes",settingName:(0,c.__)("Regular quotes to german book-style quotes","consistency"),settingDescription:{__html:(0,c.__)("Replaces regular quotes with german book-style quotes:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>\" \"</code> <span style={ { fontSize: '20px' } }>→</span> <code>» «</code></span>"}}),(0,r.createElement)(k,{settingSlug:"regularToFrenchQuotes",settingName:(0,c.__)("Regular quotes to french","consistency"),settingDescription:{__html:(0,c.__)("Replaces regular quotes with french quotes:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>\" \"</code> <span style={ { fontSize: '20px' } }>→</span> <code>« »</code></span>"}}),(0,r.createElement)(k,{settingSlug:"regularToFrenchQuotesWithoutSpaces",settingName:(0,c.__)("Regular quotes to french quotes without spaces","consistency"),settingDescription:{__html:(0,c.__)("Replaces regular quotes with french quotes without spaces:","consistency")+"<span aria-hidden='true' style={ { display: 'block' } }><code>\" \"</code> <span style={ { fontSize: '20px' } }>→</span> <code>« »</code></span>"}}),(0,r.createElement)(k,{settingSlug:"breakingSpace",settingName:(0,c.__)("Breaking space","consistency"),settingDescription:{__html:sprintf((0,c.__)("Replaces a breaking space followed by a character from this list:%1$s with a non-breaking space","consistency"),"<br /><code>? ! : ; » € $ £ ¥ ₽ 元 %</code><br />")}}),(0,r.createElement)(k,{settingSlug:"noSpaceBefore",settingName:(0,c.__)("No space before","consistency"),settingDescription:{__html:sprintf((0,c.__)("Adds a non-breaking space before a character from this list:%1$s having no space before","consistency"),"<br /><code>? ! : ; » € $ £ ¥ ₽ 元 %</code><br />")}}),(0,r.createElement)(k,{settingSlug:"noBreakingSpaceAfter",settingName:(0,c.__)("No breaking space after","consistency"),settingDescription:{__html:sprintf((0,c.__)("Adds a breaking space after a character from this list:%1$s when followed with another character","consistency"),"<br /><code>, … ) ]</code><br />")}}),(0,r.createElement)(k,{settingSlug:"noNonBreakingSpaceAfter",settingName:(0,c.__)("No non breaking space after","consistency"),settingDescription:{__html:(0,c.__)("Adds a non-breaking space after open french quote having no space after","consistency")}}),(0,r.createElement)(k,{settingSlug:"spaceBefore",settingName:(0,c.__)("Space before","consistency"),settingDescription:{__html:(0,c.__)("Remove any space preceding a character from this list:","consistency")+"<span style={ { display: 'block' } }><code>? ! : ; %</code></span>"}}),(0,r.createElement)(k,{settingSlug:"capitalizeFirstSentenceLetter",settingName:(0,c.__)("First sentence letter not capitalized","consistency"),settingDescription:{__html:(0,c.__)("Capitalize the first letter of a sentence","consistency")}}))),(0,r.createElement)(i.PluginSidebarMoreMenuItem,{target:"consistency-custom-sidebar"},(0,c.__)("Consistency Settings","consistency")))}}),o()((()=>{e.g.consistencyLoop=0,e.g.previousFixCanceledContent="",e.g.previousFixCanceled=!1,e.g.contentPasted=!1,document.querySelector("#editor")?.addEventListener("paste",(t=>{e.g.contentPasted=!0})),document.querySelector("#editor")?.addEventListener("keydown",(t=>{90===t.keyCode&&(t.ctrlKey||t.metaKey)&&(e.g.previousFixCanceled=!0,t.preventDefault())})),(0,n.subscribe)((()=>{const{onTheFly:t,onPaste:s}=(()=>{const e={onTheFly:!1,onPaste:!1},t=(0,n.select)(u.store).getCurrentUser(),s=g("root","user",t?.id||0,"consistency_plugin_user_settings"),o=s?.meta?.consistency_plugin_user_settings;return e.onTheFly=o?.find((e=>"on_the_fly"===e.slug))?.value||!1,e.onPaste=o?.find((e=>"on_paste"===e.slug))?.value||!1,e})();if(!t&&!s)return;const o=(()=>{const e=g("root","site"),t=e?.consistency_plugin_settings;return t})();if(void 0===o)return;if(e.g.contentPasted&&s)return void(t=>{const{settings:n}=t;let s=_.filter((e=>!0===n?.find((t=>t.slug===e.name))?.value));const o=v(),r=o.flatMap((({innerBlocks:e,...t})=>e.map((e=>({...t,...e}))))),c=o.reduce(((e,t)=>{let n=t.attributes?.content;return y.includes(t.name)&&void 0!==n?(Object.entries(s).forEach((([e,t])=>{if(b(t.name)){if(m.includes(t.name)){const e=t.mask.toString().match(/(?<=\/).+?(?=\/)/g)[0],s=new RegExp(`(?<!=)${e}(?!>)([^${e}]*)(?<!=)${e}(?!>)`,"g");n=n.replaceAll(s,t.replace)}if(!m.includes(t.name)){const e=t.mask.toString(),s=new RegExp(e.substring(1,e.length-1),"g");n=n.replaceAll(s,t.replace)}}})),void 0!==n&&(e[t.clientId]={content:n}),e):e}),{});Object.keys(c).length>0&&e.g.contentPasted&&(e.g.contentPasted=!1,x(Object.keys(c),c,!0)),e.g.contentPasted=!1,r.forEach((e=>{if(!y.includes(e.name))return;const t=e.clientId;e?.clientId&&N({currentBlockId:t,theRegs:s,isPasting:!0})}))})({settings:o});const r=T();if(null===r||e.g.contentPasted||!t)return;const c=F(r);c.hasOwnProperty("content")&&e.g.previousFixCanceledContent===c.content||(e.g.previousFixCanceledContent=c.content,D()&&N({currentBlockId:r,isPasting:!1,settings:o}))}))}))})();